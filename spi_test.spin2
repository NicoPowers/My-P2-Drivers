{Object_Title_and_Purpose}


CON
  _clkfreq = 150_000_000
  clk = 60
  mosi = 59
  miso = 58
  cs = 61

VAR
  long  symbol
  long  stringAddress

OBJ
  SPI      : "spi.spin2"


PUB main() | data

pinh(cs)


' clk, mosi, miso, mode, frequency
SPI.INIT(clk, mosi, miso, 0, 1_000_000)

' check manufacturer id and device id (should be $EF and $17, respectively)
pinl(cs)
SPI.WRITE($90FF_FF00, 32, false)
data := SPI.READ(8, false)
debug(uhex(data))
data := SPI.READ(8, false)
debug(uhex(data))
pinh(cs)

waitms(1)

repeat 5
  pinl(cs)

  'read address to ensure it is erased ($FF)
  SPI.WRITE($0380_0000, 32, false)
  data := SPI.READ(16, false)
  debug(uhex(data))
  pinh(cs)

waitms(1)

if (data == $FF)
    debug("data is empty")
  ' write enable
    pinl(cs)
    SPI.WRITE($0600_0000, 8, false)
    pinh(cs)
    waitms(1)
    pinl(cs)
  ' if cleared, we can write "Hello World"
    SPI.WRITE($0280_0000, 32, false)
    SPI.WRITE($1234_0000, 16, false)
    pinh(cs)



repeat

